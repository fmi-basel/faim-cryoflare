{
    "__comment__":"definition of general job types and their submission parameters",

    "interactive":{
        "match_command":"None",
        "job_parameters":{
            "nproc":1,
            "nthread":1,
            "submit_command":"sh"
    
        }
    },
    "submit":{
        "match_command":"None",
        "relion_remove_parameter":[
            "gpu",
            "j"
        ],
        "job_parameters":{
            "nproc":10,
            "nthread":2,
            "partition":"cpu_short",
            "mem":"32G",
            "submit_command":"sbatch"
        }
    },
    "gpu":{
        "match_command":"None",
        "inherits":"submit",
        "relion_add_parameter":{
            "gpu":"\"\""
        },
        "job_parameters":{
            "partition":"gpu_long",
            "nproc":21,
            "ngpu":4,
            "nproc_slurm":30,
            "nthread_slurm":2,
            "mem":"240G"
        }
    },
    "sp":{
        "match_command":"None",
        "inherits":"submit",
        "job_parameters":{
            "nproc":1,
            "nthread":1
            }
    },



    "__comment__":"definition of specialized job types for each relion job",
    "__comment__":"specialized types inherit basic types from above",
    "__comment__":"specialized types are matched based on match_command, match_parameter,nomatch_parameter",

    "refine":{
        "match_command":"relion_refine",
        "nomatch_parameter":["skip_align","multibody_masks"],
        "inherits":"gpu",
        "adjust_GPU_nproc_to_mem":[4,32212254720],
        "relion_add_parameter":{
            "free_gpu_memory":1000
        }
    },
    "refine_multibody":{
        "match_command":"relion_refine",
        "match_parameter":"multibody_masks",
        "inherits":"gpu",
        "job_parameters":{
            "nproc":5
            },
        "relion_add_parameter":{
            "free_gpu_memory":1000
        }
    },
    "refine_noalign":{
        "match_command":"relion_refine",
        "nomatch_parameter":"multibody_masks",
        "match_parameter":"skip_align",
        "inherits":"submit",
        "job_parameters":{
            "mem":"145G",
            "partition":"cpu_long",
            "nproc":10
        }
    },
    "ctffind_gctf":{
        "match_command":"relion_run_ctffind",
        "match_parameter":"use_gctf",
        "inherits":"gpu",
        "job_parameters":{
            "nproc":4,
            "nthread":1
        }
    },
    "ctffind_ctffind":{
        "match_command":"relion_run_ctffind",
        "match_parameter":"ctffind_exe",
        "inherits":"submit",
        "job_parameters":{
            "nthread":1
        }
    },
    "ctfrefine":{
        "match_command":"relion_ctf_refine",
        "inherits":"submit",
        "job_parameters":{
            "mem":"64G"
        }
    },
    "extract":{
        "match_command":"relion_preprocess",
        "inherits":"submit",
        "job_parameters":{
            "nthread":1
        }
    },
    "import":{
        "match_command":"relion_star_loopheader",
        "inherits":"sp"
    },
    "joinstar":{
        "match_command":"relion_star_handler",
        "inherits":"sp"
    },
    "localres":{
        "match_command":"relion_postprocess",
        "match_parameter":"locres",
        "inherits":"submit",
        "job_parameters":{
            "nproc":4,
            "nthread":1
        }
    },
    "maskcreate":{
        "match_command":"relion_mask_create",
        "inherits":"sp",
        "job_parameters":{
            "nthread":8
        }
},
    "motioncorr_mc2":{
        "match_command":"relion_run_motioncorr",
        "match_parameter":"use_motioncor2",
        "inherits":"gpu",
        "job_parameters":{
            "__comment__":"motioncorr2 can run only one process per GPU",
            "nproc":4,
            "nthread":1,
            "mem":"32G"
        }
    },
    "motioncorr_own":{
        "match_command":"relion_run_motioncorr",
        "match_parameter":"use_own",
        "inherits":"submit",
        "job_parameters":{
            "nproc":40,
            "mem":"300G"
        }
    },
    "autopick_laplacian":{
        "match_command":"relion_autopick",
        "match_parameter":"LoG",
        "inherits":"submit",
        "job_parameters":{
            "nthread":1
        }
    },
    "autopick_ref_write_FOM":{
        "match_command":"relion_autopick",
        "match_parameter":"write_fom_maps",
        "inherits":"sp",
        "job_parameters":{
            "__comment__":"relion can only use one process when writing out FOM maps"
        }
    },
    "autopick_ref_read_FOM":{
        "match_command":"relion_autopick",
        "match_parameter":"read_fom_maps",
        "inherits":"sp",
        "job_parameters":{
            "__comment__":"using CPU job for reading FOM maps, as little computation is needed"
        }
    },
    "autopick_ref":{
        "match_command":"relion_autopick",
        "match_parameter":"ref",
        "nomatch_parameter":["write_fom_maps","read_fom_maps"],
        "inherits":"gpu",
        "job_parameters":{
            "__comment__":"todo: figure out how many processes we can run per GPU to not hit memory limit",
            "nthread":1,
            "nproc":4,  
            "nthread_slurm":1,
            "nproc_slurm":4,
            "mem":"32G"
        }
    },
    "polish_train":{
        "match_command":"relion_motion_refine",
        "match_parameter":"eval_frac",
        "inherits":"sp",
        "job_parameters":{
            "mem":"64G",  
            "nthread":16
        }
    },
    "polish":{
        "match_command":"relion_motion_refine",
        "nomatch_parameter":"eval_frac",
        "inherits":"submit",
        "job_parameters":{
            "mem":"240G"   
        }
    },
    "postprocess":{
        "match_command":"relion_postprocess",
        "nomatch_parameter":"locres",
        "inherits":"sp"
    },
    "sort":{
        "match_command":"relion_particle_sort",
        "inherits":"submit",
        "job_parameters":{
            "nthread":1
            
        }
    },
    "subtract":{
        "match_command":"relion_project",
        "inherits":"sp"
    },
    "diplay":{
        "match_command":"relion_display",
        "inherits":"interactive"
    },
    "manualpick":{
        "match_command":"relion_manualpick",
        "inherits":"interactive"
    }
}
